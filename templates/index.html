
<!DOCTYPE html>
<!--[if lt IE 9]><html class="lte-ie8" lang="en"><![endif]-->
<!--[if gt IE 8]><!--><html lang="en"><!--<![endif]-->
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <title>GOV.UK - The best place to find government services and information</title>

  
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
	<script src="static/js/d3.v3.min.js"></script>
	<script src="static/js/papaparse.min.js"></script>
	<script src="static/js/defiant.js"></script>
<script>

function uploadFile() {
  var xhr = new XMLHttpRequest();
  var fd = document.getElementById('form1').getFormData();

  /* event listners */
  xhr.upload.addEventListener("progress", uploadProgress, false);
  xhr.addEventListener("load", uploadComplete, false);
  xhr.addEventListener("error", uploadFailed, false);
  xhr.addEventListener("abort", uploadCanceled, false);
  /* Be sure to change the url below to the url of your upload server side script */
  xhr.open("POST", "UploadMinimal.aspx");
  xhr.send(fd);
}
function fileSelected() {
  var file = document.getElementById('fileToUpload').files[0];
  if (file) {
    var fileSize = 0;
    if (file.size > 1024 * 1024)
      fileSize = (Math.round(file.size * 100 / (1024 * 1024)) / 100).toString() + 'MB';
    else
      fileSize = (Math.round(file.size * 100 / 1024) / 100).toString() + 'KB';
          
    document.getElementById('fileName').innerHTML = 'Name: ' + file.name;
    document.getElementById('fileSize').innerHTML = 'Size: ' + fileSize;
    document.getElementById('fileType').innerHTML = 'Type: ' + file.type;
  }
}
function uploadProgress(evt) {
        if (evt.lengthComputable) {
          var percentComplete = Math.round(evt.loaded * 100 / evt.total);
          document.getElementById('progressNumber').innerHTML = percentComplete.toString() + '%';
        }
        else {
          document.getElementById('progressNumber').innerHTML = 'unable to compute';
        }
      }

      function uploadComplete(evt) {
        /* This event is raised when the server send back a response */
        alert(evt.target.responseText);
      }

      function uploadFailed(evt) {
        alert("There was an error attempting to upload the file.");
      }

      function uploadCanceled(evt) {
        alert("The upload has been canceled by the user or the browser dropped the connection.");
      }
</script>

    <!--[if gt IE 8]><!--><link href="/static/css/govuk-template.css" media="screen" rel="stylesheet" type="text/css" /><!--<![endif]-->
    <!--[if IE 6]><link href="/static/css/govuk-template-ie6.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
    <!--[if IE 7]><link href="/static/css/govuk-template-ie7.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
    <!--[if IE 8]><link href="/static/css/govuk-template-ie8.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
<style>
.fileContainer {
   position:relative;
    overflow:hidden;
    cursor:pointer;
    text-align:center;
    background-color:#83b81a;
    color:#fff;display:block;
    
    width:197px;
    height:31px;
    font-size:18px;
    line-height:30px;
    float:left;
}

.fileContainer [type=file] {
    cursor: inherit;
    display: block;
    font-size: 999px;
    filter: alpha(opacity=0);
    min-height: 100%;
    min-width: 100%;
    opacity: 0;
    position: absolute;
    right: 0;
    text-align: right;
    top: 0;
}

/* Example stylistic flourishes */



  .example {
  padding: 10px;
    margin: 60px 0;

   border-style: solid;
    border-color: #98bf21;
    width:80%;
    height:150px;
    
}

  .textcont {
  padding: 10px;
   margin: 80px 0;
    width:80%;
    height:120px;
}


</style>
    <link href="/static/css/govuk-template-print.css" media="print" rel="stylesheet" type="text/css" />

    <!--[if IE 8]>
    <script type="text/javascript">
      (function(){if(window.opera){return;}
       setTimeout(function(){var a=document,g,b={families:(g=
       ["nta"]),urls:["/static/css/fonts-ie8.css"]},
       c="/static/javascripts/vendor/goog/webfont-debug.js",d="script",
       e=a.createElement(d),f=a.getElementsByTagName(d)[0],h=g.length;WebFontConfig
       ={custom:b},e.src=c,f.parentNode.insertBefore(e,f);for(;h=h-1;a.documentElement
       .className+=' wf-'+g[h].replace(/\s/g,'').toLowerCase()+'-n4-loading');},0)
      })()
    </script>
    <![endif]-->
    <!--[if gte IE 9]><!-->
      <link href="/static/css/fonts.css" media="all" rel="stylesheet" type="text/css" />
    <!--<![endif]-->


    <!--[if lt IE 9]>
      <script src="/static/javascripts/ie.js" type="text/javascript"></script>
    <![endif]-->

    <link rel="shortcut icon" href="/static/images/favicon.ico" type="image/x-icon" />

    <!-- Size for iPad and iPad mini (high resolution) -->
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/static/images/apple-touch-icon-152x152.png">
    <!-- Size for iPhone and iPod touch (high resolution) -->
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/static/images/apple-touch-icon-120x120.png">
    <!-- Size for iPad 2 and iPad mini (standard resolution) -->
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/static/images/apple-touch-icon-76x76.png">
    <!-- Default non-defined size, also used for Android 2.1+ devices -->
    <link rel="apple-touch-icon-precomposed" href="/static/images/apple-touch-icon-60x60.png">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:image" content="/static/images/opengraph-image.png">

    
  </head>

  <body>
    <script type="text/javascript">document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    

    <div id="skiplink-container">
      <div>
        <a href="#content" class="skiplink">Skip to main content</a>
      </div>
    </div>

    <div id="global-cookie-message">
      <div class="outer-block">
        <div class="inner-block">
          
            <p>GOV.UK uses cookies to make the site simpler. <a href="https://www.gov.uk/help/cookies">Find out more about cookies</a></p>
          
        </div>
      </div>
    </div>
    <!--end global-cookie-message-->

    
    <header role="banner" id="global-header" class="">
      <div class="header-wrapper">
        <div class="header-global">
          <div class="header-logo">
            <a href="https://www.gov.uk/" title="Go to the GOV.UK homepage" id="logo" class="content">
              <img src="/static/images/gov.uk_logotype_crown.png" width="35" height="31" alt=""> GOV.UK
            </a>
          </div>
          
        </div>
        
      </div>
    </header>
    <!--end header-->
    

    

    <div id="global-header-bar">
    
      <div class="inner-block">
<br/>
       <h1>Simplified School Performance Information </h1>
       
<p><br/></p>

<label class="fileContainer">Upload a file
  <input type="file" id="files" name="files[]"  /></label>
  
 <div class="example"> 
<output id="list"><p align="left"> <strong>Please upload your file with the school names and postcode. </strong><br/><br/> <i>Example file format:</i> <br/><img src="/static/images/Fileexample.png" alt="Example file format" style="width:200px;height:60px"> </p></output></div>

<script type="text/javascript">
var dataset = [];

  d3.csv("/static/data/SimplifiedKS4.csv", function(data) {
        dataset=data
        
        });


var dataset2 = [];
var res=[];
var res2=[];
  d3.csv("/static/data/SimplifiedKS5.csv", function(data) {
        dataset2=data
        });


function doStuff(data) {
    //Data is usable here
    
    
  for(var i=0;i<data.length;i++){
        var obj = data[i];
        
       for(var j=0;j<dataset.length;j++){
          var val=dataset[j]['SCHNAME'];
            if(new String(val).valueOf() == new String(obj.SCHNAME).valueOf()){
               res.push(dataset[j]);
               
            }
       }
 
     
    }
    
       
  for(var i=0;i<data.length;i++){
        var obj = data[i];

       for(var j=0;j<dataset2.length;j++){
          var val=dataset2[j]['SCHNAME'];
            if(new String(val).valueOf() == new String(obj.SCHNAME).valueOf()){
               res2.push(dataset2[j]);
            }
       }
 
     
    }
    
   
    
    function JSON2CSV(objArray) {
    var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
    var l1=['URN','SCHNAME','TOWN','PCODE','PTPRIORLO','PTPRIORAV','PTPRIORHI','PTAC5EM_PTQ','PTFSMCLA','TFSMCLA','TNOTFSMCLA'];
    var str =  l1 + '\r\n';
   
    var line = '';

  
    for (var i = 0; i < array.length; i++) {
        var line = '';
        var count=0;
            for (var index in array[i]) {
                line += array[i][index] + ',';
                
            }
       
        
    
       line = line.slice(0, -1);
    
        str += line + '\n';
        
        
    }
    return str;
    
}
        
        
function JSON2CSV2(objArray) {
    var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
  var l1=['URN','SCHNAME','TOWN','PCODE','TPUP1618','TALLPPEGRD_ALEVA'];

    var str =  l1 + '\r\n';
   
    var line = '';

    if ($("#labels").is(':checked')) {
        var head = array[0];
        if ($("#quote").is(':checked')) {
            for (var index in array[0]) {
                var value = index + "";
                line += '"' + value.replace(/"/g, '""') + '",';
            }
        } else {
            for (var index in array[0]) {
                line += index + ',';
            }
        }

        line = line.slice(0, -1);
        str += line + '\r\n';
    }

    for (var i = 0; i < array.length; i++) {
        var line = '';

        if ($("#quote").is(':checked')) {
            for (var index in array[i]) {
                var value = array[i][index] + "";
                line += '"' + value.replace(/"/g, '""') + '",';
            }
        } else {
            for (var index in array[i]) {
                line += array[i][index] + ',';
            }
        }
    
        line = line.slice(0, -1);
           
        str += line + '\r\n';
    }
    return str;
    
}
        

$("#download").click(function() {
 //   var json = $.parseJSON($("#json").val());
    var csv = JSON2CSV(res);
    window.open("data:text/csv;charset=utf-8," + escape(csv))
});

$("#download2").click(function() {
 //   var json = $.parseJSON($("#json").val());
    var csv = JSON2CSV2(res2);
    window.open("data:text/csv;charset=utf-8," + escape(csv))
});



}

function parseData(url, callBack) {
    Papa.parse(url, {
        download: true,
        dynamicTyping: true,
        header:true,
        complete: function(results) {
            callBack(results.data);
        }
    });
}


  function handleFileSelect(evt) {
  
  
    var files = evt.target.files; // FileList object

    // files is a FileList of File objects. List some properties.
    var output = [];
    for (var i = 0, f; f = files[i]; i++) {
      output.push('<p style="margin-left:-30px;align:left;"><font face="helvetica" color="#4a4d52"  size="5">Thank you for uploading </font> </p><li><strong>', escape(f.name), '</strong>  - ',
                  f.size, ' bytes, last modified: ',
                  f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
                  '</li>');

output.push('<br/>   <button id="download" style="background-color:#CAC8C8">Download your KS4 data</button>  <button id="download2" style="background-color:#CAC8C8">Download your KS5 data</button>');
parseData(f, doStuff);

     
 
    
    }
    document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
  }

  document.getElementById('files').addEventListener('change', handleFileSelect, false);


</script>
</div>

<div class="textcont"></div>


            <div class="header-bar"></div>
      </div>
    </div>
    <!--end global-header-bar-->

 
    <!-- Page content goes here -->

    <footer class="group js-footer" id="footer" role="contentinfo">

      <div class="footer-wrapper">
        

        <div class="footer-meta">
          <div class="footer-meta-inner">
            

            <div class="open-government-licence">
              <p class="logo"><a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license">Open Government Licence</a></p>
              <p>All content is available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license">Open Government Licence v3.0</a>, except where otherwise stated</p>
            </div>
          </div>

          <div class="copyright">
            <a href="https://www.nationalarchives.gov.uk/information-management/our-services/crown-copyright.htm">&copy; Crown copyright</a>
          </div>
        </div>
      </div>
    </footer>

    <!--end footer-->

    <div id="global-app-error" class="app-error hidden"></div>

<!--    <script src="/static/javascripts/govuk-template.js" type="text/javascript"></script>-->

    
  </body>
</html>
